<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platemate - Combo Offers</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@300;400;500;600&family=Oswald:wght@600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Raleway', sans-serif;
        }

        .tm-bg-brown {
            background-color: #8B4513;
        }

        .tm-text-gold {
            color: #D4AF37;
        }

        .tm-text-brown {
            color: #8B4513;
        }

        .tm-border-gold {
            border-color: #D4AF37;
        }

        .tm-bg-green {
            background-color: #2E8B57;
        }

        .tm-text-green {
            color: #2E8B57;
        }

        .circular-image {
            border-radius: 50%;
            object-fit: cover;
            width: 80px;
            height: 80px;
            border: 3px solid #D4AF37;
        }

        .tm-item-container {
            color: white;
        }

        .parallax-window {
            min-height: 100vh;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
        }

        .logo-font {
            font-family: 'Oswald', sans-serif;
        }

        /* Combo Items Grid */
        .combo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .combo-item-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .combo-item-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.15);
        }

        .combo-item-img {
            width: 100%;
            height: 60px;
            object-fit: cover;
        }

        .combo-item-name {
            font-size: 10px;
            text-align: center;
            padding: 4px;
            color: #8B4513;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Badge for number of items in combo */
        .combo-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #D4AF37;
            color: #8B4513;
            font-size: 12px;
            font-weight: bold;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        /* Menu Headings Styled as Attractive Buttons */
        .menu-heading-btn {
            display: inline-block;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #ff7b00, #ff5500);
            color: white;
            text-align: center;
            min-width: 180px;
            margin: 0 8px;
            text-decoration: none;
            line-height: 1.2;
        }

        .menu-heading-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .menu-heading-btn:hover::before {
            left: 100%;
        }

        .menu-heading-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            color: white;
            text-decoration: none;
        }

        .menu-heading-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Individual Button Color Variations */
        .menu-heading-btn.combo-offers {
            background: linear-gradient(135deg, #D2691E, #A0522D);
            border: 2px solid #8B4513;
            color: #FFEBCD;
        }

        .menu-heading-btn.combo-offers:hover {
            background: linear-gradient(135deg, #B3591B, #8B4513);
            color: #FFEBCD;
        }

        /* Animation for page load */
        @keyframes buttonSlideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .menu-heading-btn {
            animation: buttonSlideIn 0.6s ease-out;
        }

        /* Modal animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Hide number input arrows */
        .quantity-input::-webkit-outer-spin-button,
        .quantity-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .quantity-input[type=number] {
            -moz-appearance: textfield;
        }

        /* Selected counter styling */
        .selected-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #d4af37, #8B4513);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 200px;
            text-align: center;
        }

        .selected-counter .total {
            font-size: 1.2em;
            margin-top: 5px;
        }

        /* Print styles */
        @media print {
            .place-order-btn,
            .selected-counter {
                display: none !important;
            }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #D4AF37;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #8B4513;
        }
    </style>
</head>
<body class="bg-amber-50">

    <!-- Menu Section -->
    <div id="menu" class="parallax-window" style="background-image: url('https://images.unsplash.com/photo-1414235077428-338989a2e8c0?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80')">
        <div class="container mx-auto py-24">
            <div class="text-center mb-16">
                <h2 class="bg-white tm-text-brown py-6 px-12 text-4xl font-medium inline-block rounded-md">Our Combo Offers</h2>
            </div>

            <!-- Navigation Buttons -->
            <div class="menu-headings-container mb-10">
                <a href="/" class="menu-heading-btn full-menu">
                    <i class="fas fa-utensils"></i> Full Menu
                </a>

                <a href="/combooffer/" class="menu-heading-btn combo-offers active">
                    <i class="fas fa-box"></i> Combo Offers
                </a>
                <a href="/special_offer/" class="menu-heading-btn special-offers">
                    <i class="fas fa-percent"></i> Special Offers
                </a>
            </div>

            <!-- Table Info -->
            <div class="mb-6">
                <h1 class="text-3xl font-bold tm-text-brown inline-block bg-white px-6 py-3 rounded-lg shadow-lg">
                    <i class="fas fa-table mr-2"></i>Table: {{num}}
                </h1>
            </div>

            <!-- Menu Items -->
            <div class="flex flex-col lg:flex-row justify-around items-center">
                <div class="flex-1 m-5 rounded-xl px-4 py-6 sm:px-8 sm:py-10 tm-bg-brown tm-item-container shadow-2xl">
                    <div class="overflow-x-auto">
                        <table class="w-full text-white">
                            <thead>
                                <tr>
                                    <th colspan="6">
                                        <div class="flex items-center justify-between mb-6">
                                            <h3 class="text-2xl font-bold tm-text-gold">
                                                <i class="fas fa-box-open mr-2"></i>Available Combo Offers
                                            </h3>
                                            <div class="flex items-center space-x-2">
                                                <span class="bg-amber-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                                                    {{ mnu|length }} Combos
                                                </span>
                                            </div>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <thead>
                                <tr class="border-b-2 tm-border-gold bg-amber-900">
                                    <th class="py-4 text-left pl-4">SL NO:</th>
                                    <th class="py-4 text-left">Combo Details</th>
                                    <th class="py-4 text-left">Combo Image</th>
                                    <th class="py-4 text-left">Combo Items</th>
                                    <th class="py-4 text-left">Price</th>
                                    <th class="py-4 text-left">Quantity & Select</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for combo in mnu %}
                                <tr class="border-b border-amber-200 hover:bg-amber-900 transition duration-300 group">
                                    <th scope="row" class="scope py-4 text-left pl-4">
                                        <div class="w-8 h-8 bg-amber-600 rounded-full flex items-center justify-center mx-auto">
                                            {{forloop.counter}}
                                        </div>
                                    </th>
                                    
                                    <!-- Combo Details -->
                                    <td class="py-4">
                                        <div class="space-y-2">
                                            <h3 class="font-bold text-xl tm-text-gold">{{combo.combo_name}}</h3>
                                            <p class="text-amber-200 text-sm">{{combo.description|default:"Delicious combination of multiple items"}}</p>
                                            <div class="flex items-center space-x-2 mt-2">
                                                <span class="bg-amber-700 text-white px-3 py-1 rounded-full text-xs font-bold">
                                                    <i class="fas fa-box mr-1"></i> {{combo.items.count }} items
                                                </span>
                                                <span class="bg-green-700 text-white px-3 py-1 rounded-full text-xs font-bold">
                                                    <i class="fas fa-percent mr-1"></i> Save {{combo.discount_percentage|default:"15"}}%
                                                </span>
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- Combo Main Image -->
                                    <td class="py-4">
                                        <div class="relative">
                                            {% if combo.image %}
                                            <img
                                                src="{{combo.image.url}}"
                                                class="w-20 h-20 rounded-full object-cover border-4 border-amber-300 shadow-lg transform group-hover:scale-110 transition duration-300 cursor-pointer"
                                                alt="{{combo.combo_name}}"
                                                onclick="openImageModal('{{combo.image.url}}', '{{combo.combo_name}}')"
                                            >
                                            {% else %}
                                            <div class="w-20 h-20 rounded-full border-4 border-amber-300 bg-gradient-to-r from-amber-400 to-amber-600 flex items-center justify-center shadow-lg">
                                                <i class="fas fa-box text-white text-2xl"></i>
                                            </div>
                                            {% endif %}
                                            <div class="absolute -top-2 -right-2 bg-gradient-to-r from-amber-400 to-amber-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                                                COMBO
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- Combo Items Display -->
                                    <td class="py-4">
                                        <div class="combo-grid max-w-xs">
                                            {% for item in combo.items.all|slice:":4" %}
                                            <div class="combo-item-card" title="{{item.name}}">
                                                {% if item.image or item.itemimage %}
                                                <img
                                                    src="{% if item.image %}{{item.image.url}}{% else %}{{item.itemimage.url}}{% endif %}"
                                                    class="combo-item-img"
                                                    alt="{{item.name}}"
                                                >
                                                {% else %}
                                                <div class="combo-item-img bg-amber-100 flex items-center justify-center">
                                                    <i class="fas fa-utensil-spoon text-amber-400"></i>
                                                </div>
                                                {% endif %}
                                                <div class="combo-item-name">{{item.name|truncatechars:12}}</div>
                                            </div>
                                            {% endfor %}
                                            {% if combo.items.count > 4 %}
                                            <div class="combo-item-card bg-gradient-to-r from-amber-400 to-amber-500 flex items-center justify-center">
                                                <span class="text-white font-bold text-sm">+{{combo.items.count|add:"-4"}} more</span>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </td>
                                    
                                    <!-- Price -->
                                    <td class="py-4">
                                        <div class="space-y-1">
                                            <div class="text-2xl font-bold tm-text-gold">Rs: {{combo.combo_price}}</div>
                                            {% if combo.original_price %}
                                            <div class="text-sm text-amber-200 line-through">Rs: {{combo.original_price}}</div>
                                            {% endif %}
                                            <div class="text-xs text-green-300 font-semibold">
                                                <i class="fas fa-save mr-1"></i>Save Rs: {% widthratio combo.combo_price 1 0.15 %}
                                            </div>
                                        </div>
                                    </td>
                                    
                                    <!-- Quantity Controls -->
                                    <td class="py-4">
                                        <div class="flex items-center space-x-3">
                                            <!-- Select Section -->
                                            <div class="select-section flex items-center space-x-3">
                                                <!-- Quantity Input -->
                                                <div class="quantity-control">
                                                    <div class="flex items-center space-x-1">
                                                        <button
                                                            onclick="decreaseQuantity(this)"
                                                            class="w-8 h-8 flex items-center justify-center bg-amber-100 hover:bg-amber-200 border border-amber-300 rounded-lg transition duration-200 text-amber-700 font-bold text-lg"
                                                        >
                                                            -
                                                        </button>
                                                        <input
                                                            type="number"
                                                            value="1"
                                                            min="1"
                                                            max="99"
                                                            class="quantity-input w-16 h-8 text-center border-2 border-amber-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-300 font-bold text-amber-700"
                                                            onchange="validateQuantity(this)"
                                                            oninput="validateQuantity(this)"
                                                        >
                                                        <button
                                                            onclick="increaseQuantity(this)"
                                                            class="w-8 h-8 flex items-center justify-center bg-amber-100 hover:bg-amber-200 border border-amber-300 rounded-lg transition duration-200 text-amber-700 font-bold text-lg"
                                                        >
                                                            +
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <!-- Select Button -->
                                                <button
    onclick="selectCombo(this, {{combo.id}}, '{{combo.combo_name}}', {{combo.combo_price}}, '{% if combo.image %}{{combo.image.url}}{% endif %}')"
    class="select-btn bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-400 focus:ring-opacity-50 flex items-center space-x-2"
>
    <i class="fas fa-plus"></i>
    <span>Add to Cart</span>
</button>
                                            </div>
                                            
                                            <!-- Selected State -->
                                            <div class="selected-state hidden flex items-center space-x-3">
                                                <!-- Tick Mark -->
                                                <div class="tick-mark animate-pulse">
                                                    <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                                                    </svg>
                                                </div>
                                                
                                                <!-- Quantity Display -->
                                                <div class="quantity-display-edit flex items-center space-x-2">
                                                    <div class="flex items-center space-x-1 bg-green-50 border border-green-200 rounded-lg px-3 py-1">
                                                        <span class="text-green-700 font-semibold quantity-text">Qty: 1</span>
                                                    </div>
                                                </div>
                                                
                                                <!-- Remove Button -->
                                                <button
                                                    onclick="removeItem(this, {{combo.id}})"
                                                    class="remove-btn bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 flex items-center space-x-2"
                                                >
                                                    <i class="fas fa-trash"></i>
                                                    <span>Remove</span>
                                                </button>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="py-8 text-center">
                                        <div class="text-4xl mb-4">ðŸ“¦</div>
                                        <h3 class="text-xl font-semibold text-amber-200">No combo offers available</h3>
                                        <p class="text-amber-300">Please check back later for exciting combo deals!</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Place Order Button -->
    <div class="fixed bottom-6 right-6 z-50">
        <button
            id="placeOrderBtn"
            onclick="showOrderSummary()"
            class="place-order-btn bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 px-8 rounded-full shadow-2xl transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-400 focus:ring-opacity-50 text-lg flex items-center space-x-2"
        >
            <i class="fas fa-shopping-cart"></i>
            <span>View Your Order ({{cart.count}})</span>
        </button>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-4 max-w-4xl mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 id="modalTitle" class="text-xl font-bold tm-text-brown"></h3>
                <button onclick="closeImageModal()" class="text-2xl text-gray-600 hover:text-gray-900">&times;</button>
            </div>
            <img id="modalImage" src="" alt="" class="w-full h-auto rounded-lg">
        </div>
    </div>

    <!-- Order Summary Modal -->
    <!-- Order Summary Modal - Updated Version -->
<!-- Order Summary Modal - Shows All Cart Types -->
<div id="orderSummaryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-2xl shadow-2xl w-11/12 max-w-5xl h-[90vh] overflow-hidden flex flex-col">
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-amber-500 to-amber-600 p-6 flex-shrink-0">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="fas fa-shopping-cart mr-3"></i>
                    Complete Order Summary
                </h2>
                <button
                    onclick="closeOrderSummary()"
                    class="text-white hover:text-amber-200 text-2xl font-bold transition duration-200 bg-transparent border-none cursor-pointer"
                >
                    âœ•
                </button>
            </div>
            <!-- Quick Stats -->

        </div>

        <!-- Modal Body - Scrollable Area -->
        <div class="flex-grow overflow-y-auto p-4 md:p-6">
            {% if all_info %}
            <!-- Regular Items Section -->
            {% if regular_info %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div class="text-center p-3 bg-amber-50 rounded-lg">
                    <span class="text-sm font-medium text-amber-700">Regular Items</span>
                    <p class="text-lg font-bold text-amber-800">Rs: {{regular_total|floatformat:2}}</p>
                </div>
                <div class="text-center p-3 bg-purple-50 rounded-lg">
                    <span class="text-sm font-medium text-purple-700">Combo Offers</span>
                    <p class="text-lg font-bold text-purple-800">Rs: {{combo_total|floatformat:2}}</p>
                </div>
                <div class="text-center p-3 bg-red-50 rounded-lg">
                    <span class="text-sm font-medium text-red-700">Special Offers</span>
                    <p class="text-lg font-bold text-red-800">Rs: {{special_total|floatformat:2}}</p>
                </div>
            </div>
            <div class="mb-6">
                <h3 class="text-lg font-bold text-amber-800 mb-3 pb-2 border-b border-amber-200 flex items-center">
                    <i class="fas fa-utensils mr-2"></i> Regular Menu Items
                </h3>
                <div class="space-y-4">
                    {% for item in regular_info %}
                    <div class="bg-gradient-to-r from-amber-50 to-white border-2 border-amber-200 rounded-xl p-4 shadow-lg hover:shadow-xl transition duration-300">
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div class="flex items-start space-x-4 mb-4 md:mb-0">
                                <!-- Item Image -->
                                <div class="flex-shrink-0">
                                    <img src="{{ item.item.itemimage.url }}"
                                         alt="{{ item.item.itemname }}"
                                         class="w-16 h-16 md:w-20 md:h-20 rounded-lg object-cover border-2 border-amber-400 shadow-md">
                                </div>
                                <!-- Item Info -->
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg md:text-xl text-gray-800">{{ item.item.itemname }}</h4>
                                    <div class="flex flex-wrap items-center gap-2 mt-2">
                                        <span class="text-amber-600 font-bold text-base md:text-lg">
                                            <i class="fas fa-tag mr-1"></i> Rs {{ item.item.itemprice }}
                                        </span>
                                        <span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            <i class="fas fa-box mr-1"></i> Qty: {{ item.cart_entry.quantity }}
                                        </span>
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            <i class="fas fa-save mr-1"></i> Total: Rs {{ item.price|floatformat:2 }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <!-- Remove Button -->
                            <button onclick="removeFromModal('{{ item.cart_entry.id }}', 'regular')"
                                    class="flex items-center space-x-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 mt-2 md:mt-0">
                                <i class="fas fa-trash"></i>
                                <span>Remove</span>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Combo Offers Section -->
            {% if combo_info %}
            <div class="mb-6">
                <h3 class="text-lg font-bold text-purple-800 mb-3 pb-2 border-b border-purple-200 flex items-center">
                    <i class="fas fa-box mr-2"></i> Combo Offers
                </h3>
                <div class="space-y-4">
                    {% for item in combo_info %}
                    <div class="bg-gradient-to-r from-purple-50 to-white border-2 border-purple-200 rounded-xl p-4 shadow-lg hover:shadow-xl transition duration-300">
                        <!-- Combo Header -->
                        <div class="flex flex-col md:flex-row md:items-start justify-between mb-4 pb-4 border-b border-purple-300">
                            <div class="flex items-start space-x-4 mb-4 md:mb-0">
                                <!-- Combo Image -->
                                <div class="flex-shrink-0 relative">
                                    {% if item.combo.image %}
                                    <img src="{{ item.combo.image.url }}"
                                         alt="{{ item.combo.combo_name }}"
                                         class="w-16 h-16 md:w-20 md:h-20 rounded-lg object-cover border-2 border-purple-400 shadow-md">
                                    {% else %}
                                    <div class="w-16 h-16 md:w-20 md:h-20 rounded-lg bg-gradient-to-r from-purple-100 to-purple-200 border-2 border-purple-300 flex items-center justify-center">
                                        <i class="fas fa-box text-purple-500 text-xl md:text-2xl"></i>
                                    </div>
                                    {% endif %}
                                    <div class="absolute -top-2 -right-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white text-xs font-bold px-2 py-1 rounded-full shadow-lg">
                                        {{ item.combo_items|length }}
                                    </div>
                                </div>
                                <!-- Combo Info -->
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg md:text-xl text-gray-800">{{ item.combo.combo_name }}</h4>
                                    <div class="flex flex-wrap items-center gap-2 mt-2">
                                        <span class="text-purple-600 font-bold text-base md:text-lg">
                                            <i class="fas fa-tag mr-1"></i> Rs {{ item.combo.combo_price }}
                                        </span>
                                        <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            <i class="fas fa-box mr-1"></i> Qty: {{ item.cart_entry.quantity }}
                                        </span>
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            <i class="fas fa-save mr-1"></i> Total: Rs {{ item.price|floatformat:2 }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Products in Combo -->
                        <div class="mt-4">
                            <h5 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <i class="fas fa-utensils mr-2 text-purple-600"></i>
                                Products in this Combo:
                            </h5>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-h-40 overflow-y-auto p-2 bg-purple-50 rounded-lg">
                                {% for product in item.combo_items %}
                                <div class="bg-white border border-purple-100 rounded-lg p-2 hover:shadow-md transition duration-200 hover:border-purple-300">
                                    <div class="flex flex-col items-center text-center">
                                        <div class="mb-2">
                                            {% if product.itemimage %}
                                            <img src="{{ product.itemimage.url }}"
                                                 alt="{{ product.itemname }}"
                                                 class="w-12 h-12 md:w-16 md:h-16 rounded-lg object-cover border border-purple-200">
                                            {% else %}
                                            <div class="w-12 h-12 md:w-16 md:h-16 rounded-lg bg-gray-100 border border-gray-300 flex items-center justify-center">
                                                <i class="fas fa-utensil-spoon text-gray-400 text-lg"></i>
                                            </div>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <h6 class="font-medium text-gray-800 text-xs md:text-sm mb-1 truncate w-full">{{ product.itemname }}</h6>
                                            {% if product.itemprice %}
                                            <p class="text-purple-600 text-xs font-semibold">Rs {{ product.itemprice }}</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="col-span-full text-center py-4 text-gray-500">
                                    <i class="fas fa-exclamation-circle text-2xl mb-2"></i>
                                    <p class="text-sm">No products found in this combo</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <!-- Remove Button -->
                        <div class="mt-4 pt-4 border-t border-purple-200 flex justify-end">
                            <button onclick="removeFromModal('{{ item.cart_entry.id }}', 'combo')"
                                    class="flex items-center space-x-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50">
                                <i class="fas fa-trash"></i>
                                <span>Remove Combo</span>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Special Offers Section -->
            {% if special_info %}
            <div class="mb-6">
                <h3 class="text-lg font-bold text-red-800 mb-3 pb-2 border-b border-red-200 flex items-center">
                    <i class="fas fa-fire mr-2"></i> Special Offers
                </h3>
                <div class="space-y-4">
                    {% for item in special_info %}
                    <div class="bg-gradient-to-r from-red-50 to-white border-2 border-red-200 rounded-xl p-4 shadow-lg hover:shadow-xl transition duration-300">
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div class="flex items-start space-x-4 mb-4 md:mb-0">
                                <!-- Special Offer Icon -->
                                <div class="flex-shrink-0">
                                    <div class="w-16 h-16 md:w-20 md:h-20 rounded-lg border-2 border-red-300 bg-red-100 flex items-center justify-center">
                                        <span class="text-red-500 text-2xl md:text-3xl">ðŸ”¥</span>
                                    </div>
                                </div>
                                <!-- Special Offer Info -->
                                <div class="flex-1">
                                    <h4 class="font-bold text-lg md:text-xl text-gray-800">{{ item.item.offer_name }}</h4>
                                    <div class="flex flex-wrap items-center gap-2 mt-2">
                                        <span class="text-red-600 font-bold text-base md:text-lg">
                                            <i class="fas fa-tag mr-1"></i> Rs {{ item.item.offer_price }}
                                        </span>
                                        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            <i class="fas fa-box mr-1"></i> Qty: {{ item.cart_entry.quantity }}
                                        </span>
                                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                                            <i class="fas fa-save mr-1"></i> Total: Rs {{ item.price|floatformat:2 }}
                                        </span>
                                    </div>
                                    {% if item.item.items %}
                                    <p class="text-xs text-gray-600 mt-2">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Includes: {{ item.item.items.itemname }}
                                    </p>
                                    {% endif %}
                                </div>
                            </div>
                            <!-- Remove Button -->
                            <button onclick="removeFromModal('{{ item.cart_entry.id }}', 'special')"
                                    class="flex items-center space-x-2 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50 mt-2 md:mt-0">
                                <i class="fas fa-trash"></i>
                                <span>Remove</span>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% else %}
            <!-- Empty Cart State -->
            <div class="text-center py-8 md:py-12 flex flex-col items-center justify-center h-full">
                <div class="text-6xl mb-6 text-amber-400">ðŸ›’</div>
                <h3 class="text-xl md:text-2xl font-semibold text-gray-600 mb-2">Your cart is empty</h3>
                <p class="text-gray-500 mb-6 max-w-md">Select some items from the menu to get started!</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <a href="/full_menu/"
                       class="bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">
                        <i class="fas fa-utensils mr-2"></i>Regular Menu
                    </a>
                    <button
                        onclick="closeOrderSummary()"
                        class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300"
                    >
                        <i class="fas fa-shopping-bag mr-2"></i>Browse Combos
                    </button>
                    <a href="/special_offer/"
                       class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300">
                        <i class="fas fa-fire mr-2"></i>Special Offers
                    </a>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Modal Footer - Fixed at bottom -->
        <div class="border-t border-gray-200 p-4 md:p-6 bg-gray-50 flex-shrink-0">
            <!-- Summary Totals -->


            <!-- Grand Total -->
            <div class="flex justify-between items-center mb-4 md:mb-6">
                <div>
                    <span class="text-lg md:text-2xl font-bold text-gray-800">Grand Total:</span>
                    <p class="text-xs text-gray-500 mt-1">Inclusive of all taxes</p>
                </div>
                <div class="text-right">
                    <div class="text-xl md:text-3xl font-bold text-green-600">Rs: {{grand_total|floatformat:2}}</div>
                    <p class="text-xs text-gray-500 mt-1">Final amount to pay</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-3">
                <button
                    onclick="closeOrderSummary()"
                    class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white font-semibold py-3 px-4 md:px-6 rounded-lg transition duration-300 flex items-center justify-center space-x-2 order-2 sm:order-1"
                >
                    <i class="fas fa-arrow-left"></i>
                    <span>Continue Shopping</span>
                </button>
                <button
                    onclick="window.location.href='/make_order/'"
                    class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-4 md:px-6 rounded-lg transition duration-300 flex items-center justify-center space-x-2 order-1 sm:order-2 {% if not all_info %}opacity-50 cursor-not-allowed{% endif %}"
                    {% if not all_info %}disabled{% endif %}
                    id="confirmOrderBtn"
                >
                    <i class="fas fa-check-circle"></i>
                    <span>Confirm Order (Rs: {{grand_total|floatformat:2}})</span>
                </button>
            </div>

            <!-- Navigation Links -->

        </div>
    </div>
</div>


    <!-- Selected Items Counter -->
    <div id="selectedCounter" class="selected-counter hidden">
        <div class="text-sm">Selected Combos</div>
        <div class="text-xl font-bold" id="selectedCount">0</div>
        <div class="total">Total: <span id="selectedTotal">Rs: 0.00</span></div>
    </div>

    <script>
        // Store selected combos
        let selectedCombos = {};

        // Image Modal Functions
        function openImageModal(imageSrc, title) {
            document.getElementById('modalImage').src = imageSrc;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('imageModal').classList.remove('hidden');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.add('hidden');
        }

        // Quantity control functions
        function increaseQuantity(button) {
            const container = button.parentElement;
            const input = container.querySelector('.quantity-input');
            const currentValue = parseInt(input.value);
            if (currentValue < 99) {
                input.value = currentValue + 1;
            }
        }

        function decreaseQuantity(button) {
            const container = button.parentElement;
            const input = container.querySelector('.quantity-input');
            const currentValue = parseInt(input.value);
            if (currentValue > 1) {
                input.value = currentValue - 1;
            }
        }

        function validateQuantity(input) {
            let value = parseInt(input.value);
            if (isNaN(value) || value < 1) {
                input.value = 1;
            } else if (value > 99) {
                input.value = 99;
            }
        }

        function selectCombo(button, comboId, comboName, comboPrice, comboImage) {
            const container = button.closest('td');
            const selectSection = container.querySelector('.select-section');
            const selectedState = container.querySelector('.selected-state');
            const quantityInput = selectSection.querySelector('.quantity-input');
            const quantity = parseInt(quantityInput.value);
            const quantityDisplay = selectedState.querySelector('.quantity-text');

            // Update display
            quantityDisplay.textContent = `Qty: ${quantity}`;
            selectSection.classList.add('hidden');
            selectedState.classList.remove('hidden');

            // Store in local storage for persistence
            const comboData = {
                id: comboId,
                name: comboName,
                price: comboPrice,
                image: comboImage,
                quantity: quantity,
                timestamp: new Date().getTime()
            };
            
            // Save to localStorage
            let savedCombos = JSON.parse(localStorage.getItem('selectedCombos') || '{}');
            savedCombos[comboId] = comboData;
            localStorage.setItem('selectedCombos', JSON.stringify(savedCombos));

            // Redirect to add cart
            window.location.href = `/add_to_cart/${comboId}/${quantity}/`;
        }

        function removeItem(button, comboId) {
            const container = button.closest('td');
            const selectSection = container.querySelector('.select-section');
            const selectedState = container.querySelector('.selected-state');
            const quantityInput = selectSection.querySelector('.quantity-input');

            // Reset UI
            quantityInput.value = 1;
            selectedState.classList.add('hidden');
            selectSection.classList.remove('hidden');

            // Remove from localStorage
            let savedCombos = JSON.parse(localStorage.getItem('selectedCombos') || '{}');
            delete savedCombos[comboId];
            localStorage.setItem('selectedCombos', JSON.stringify(savedCombos));

            // Redirect to remove from cart
            window.location.href = `/remove_cart/${comboId}/`;
        }

        function showOrderSummary() {
            const modal = document.getElementById('orderSummaryModal');
            modal.classList.remove('hidden');
            modal.style.animation = 'fadeIn 0.3s ease-in-out';
        }

        function closeOrderSummary() {
            const modal = document.getElementById('orderSummaryModal');
            modal.classList.add('hidden');
        }

        // Load saved combos on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedCombos = JSON.parse(localStorage.getItem('selectedCombos') || '{}');
            
            // Update UI for saved combos
            Object.values(savedCombos).forEach(combo => {
                const row = document.querySelector(`tr[data-combo-id="${combo.id}"]`);
                if (row) {
                    const container = row.querySelector('td:last-child');
                    const selectSection = container.querySelector('.select-section');
                    const selectedState = container.querySelector('.selected-state');
                    const quantityDisplay = selectedState.querySelector('.quantity-text');
                    const quantityInput = selectSection.querySelector('.quantity-input');
                    
                    quantityInput.value = combo.quantity;
                    quantityDisplay.textContent = `Qty: ${combo.quantity}`;
                    selectSection.classList.add('hidden');
                    selectedState.classList.remove('hidden');
                }
            });
        });

        // Close modals when clicking outside
        window.onclick = function(event) {
            const imageModal = document.getElementById('imageModal');
            const orderModal = document.getElementById('orderSummaryModal');
            
            if (event.target === imageModal) {
                closeImageModal();
            }
            if (event.target === orderModal) {
                closeOrderSummary();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Escape key closes modals
            if (event.key === 'Escape') {
                closeImageModal();
                closeOrderSummary();
            }
            
            // Spacebar shows order summary
            if (event.key === ' ' && !event.target.matches('input, textarea, button, a')) {
                event.preventDefault();
                showOrderSummary();
            }
        });
    </script>

<!-- Update the select button in your template -->
<!-- Add this JavaScript function -->
<script>
function addComboToCart(comboId, button) {
    const container = button.closest('td');
    const quantityInput = container.querySelector('.quantity-input');
    const quantity = quantityInput.value;

    // Show loading state
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
    button.disabled = true;

    // Use AJAX to add to cart
    fetch('/add_to_cart/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: `item_id=${comboId}&item_type=combo&quantity=${quantity}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Success - update UI
            const selectSection = container.querySelector('.select-section');
            const selectedState = container.querySelector('.selected-state');
            const quantityDisplay = selectedState.querySelector('.quantity-text');

            quantityDisplay.textContent = `Qty: ${quantity}`;
            selectSection.classList.add('hidden');
            selectedState.classList.remove('hidden');

            // Show success message
            showToast('âœ… ' + data.message, 'success');

            // Update cart counter
            updateCartCounter();
        } else {
            // Error
            showToast('âŒ ' + data.message, 'error');
            button.innerHTML = '<i class="fas fa-plus"></i><span>Add to Cart</span>';
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showToast('âŒ Network error. Please try again.', 'error');
        button.innerHTML = '<i class="fas fa-plus"></i><span>Add to Cart</span>';
        button.disabled = false;
    });
}

// Helper function to get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Toast notification function
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg text-white font-semibold z-50 transform transition-all duration-300 ${
        type === 'success' ? 'bg-green-500' :
        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
    }`;
    toast.textContent = message;
    document.body.appendChild(toast);

    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => document.body.removeChild(toast), 300);
    }, 3000);
}

// Update cart counter function
function updateCartCounter() {
    fetch('/get_cart_count/')
        .then(response => response.json())
        .then(data => {
            const placeOrderBtn = document.getElementById('placeOrderBtn');
            if (placeOrderBtn) {
                placeOrderBtn.innerHTML = `<i class="fas fa-shopping-cart"></i><span>View Your Order (${data.combo_count})</span>`;
            }
        });
}
</script>
</body>
</html>